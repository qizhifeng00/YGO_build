# 🎴 游戏王概率计算器

一个专业的游戏王卡组概率分析工具，支持自定义条件判断、精确计算启动率、卡手概率分析及智能卡组优化。

## ✨ 功能特性

### 📊 卡组管理
- 支持最多 30 种卡牌配置
- 保存、加载、删除卡组配置
- 单张卡牌最大上限设置（支持禁限卡）
- 饼图可视化卡组构成

### 🎲 概率计算
- **精确计算**：使用组合数学精确计算概率
- **快速估算**：使用蒙特卡洛模拟（10万次）快速估算
- **卡手概率**：基于超几何分布计算重复抽卡概率
  - 单卡卡手率分析
  - 全卡组卡手率统计

### 🔧 条件输入模式
- **手动输入**：支持复杂的逻辑表达式
- **可视化构建器**：通过界面拖拽构建条件
- **卡牌拖拽模式**：直观的卡牌拖放构建条件
- 三种模式无缝切换，自动转换条件格式

### 🎯 启动率优化器
- 设置目标启动率，自动生成调整方案
- 智能判断提高/降低模式
- 三类优化方案：
  - 保持卡组总数（替换卡牌）
  - 拓展/稀释卡组
  - 精简/移除卡牌
- 遵循单卡最大上限限制

### 📈 其他特性
- 计算记录自动保存
- 支持导出 CSV
- 响应式设计，支持移动端
- Web Worker 多线程计算

## 🛠️ 技术栈

- **Vue 3** - 渐进式 JavaScript 框架
- **Naive UI** - Vue 3 组件库
- **Chart.js** - 图表库
- **Vite** - 下一代前端构建工具
- **Web Worker** - 多线程计算
- **vuedraggable** - 拖拽排序组件

## 📦 安装

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 预览生产构建
npm run preview
```

## 📖 使用说明

### 基本流程

1. **配置卡组**：在"卡牌配置"区域输入各类卡的数量和名称
2. **设置上限**：可选设置单卡最大上限（禁限卡设为1或2）
3. **设置抽卡数**：在"决斗参数"中设置起手抽卡数量
4. **设置条件**：在"展开条件"中输入或构建判断条件
5. **开始计算**：点击"精确计算"或"快速估算"按钮

### 条件表达式语法

**运算符（优先级从高到低）：**
| 运算符 | 说明 | 示例 |
|--------|------|------|
| `()` | 括号 | `(a + b) > 2` |
| `!` | 逻辑非 | `!a` |
| `* / %` | 乘、除、取模 | `a * 2` |
| `+ -` | 加、减 | `a + b` |
| `> >= < <= == !=` | 比较 | `a >= 1` |
| `&&` | 逻辑与 | `a > 0 && b > 0` |
| `||` | 逻辑或 | `a > 0 || b > 0` |

**变量名：**
- `a, b, c, ..., z` 对应 A类卡, B类卡, ..., Z类卡
- `aa, ab, ac, ad` 对应 AA类卡, AB类卡, AC类卡, AD类卡
- 支持直接使用自定义卡名

**示例：**
```javascript
// 至少抽到1张A类卡
a > 0

// 抽到A或B类卡且没有C类卡
(a > 0 || b > 0) && c == 0

// A和B类卡合计至少3张
a + b >= 3

// 使用自定义卡名
灰流丽 > 0 && 增殖的G > 0 && 抹杀之指名者 == 0
```

### 计算原理

**概率计算**
- 精确计算：遍历所有可能的抽卡组合，统计满足条件的组合数
- 快速估算：蒙特卡洛模拟 10 万次随机抽卡

**卡手概率（超几何分布）**
```
P(k) = C(K,k) × C(N-K,n-k) / C(N,n)
```
- N = 卡组总数，K = 目标卡数量
- n = 抽卡数，k = 抽到的目标卡数
- 卡手概率 = Σ P(k≥2)

**启动率优化器**
- 使用蒙特卡洛模拟（3万次）评估每个方案
- 自动识别条件中的关键卡和非关键卡
- 根据当前概率与目标概率自动判断优化方向

### 注意事项

- ⚠️ 判断相等请使用 `==` 而不是 `=`
- ⚠️ 不要使用中文标点符号
- ⚠️ 卡种类和抽卡数较高时，精确计算时间较长，建议使用快速估算
- ⚠️ 避免使用容易与逻辑表达式混淆的卡名

## 📁 项目结构

```
├── src/
│   ├── components/                # Vue 组件
│   │   ├── DeckManagement.vue     # 卡组管理
│   │   ├── CardInput.vue          # 卡牌配置
│   │   ├── DeckPieChart.vue       # 饼图显示
│   │   ├── DrawSettings.vue       # 决斗参数
│   │   ├── ConditionInput.vue     # 条件输入（模式切换）
│   │   ├── ConditionBuilder.vue   # 可视化条件构建器
│   │   ├── ConditionNode.vue      # 条件节点组件
│   │   ├── CardDragBuilder.vue    # 卡牌拖拽构建器
│   │   ├── CalculationPanel.vue   # 计算面板
│   │   └── DeckOptimizer.vue      # 启动率优化器
│   ├── composables/               # 组合式 API
│   │   ├── useDeck.js             # 卡组管理逻辑
│   │   ├── useCalculation.js      # 概率计算逻辑
│   │   ├── useConditionBuilder.js # 条件构建器逻辑
│   │   └── useOptimizer.js        # 优化器逻辑
│   ├── App.vue                    # 主应用组件
│   └── main.js                    # 应用入口
├── index.html                     # HTML 模板
├── package.json                   # 项目配置
├── vite.config.js                 # Vite 配置
└── README.md                      # 项目文档
```

## 📄 许可证

MIT License
